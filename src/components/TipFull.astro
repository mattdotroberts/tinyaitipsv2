---
import type { Tip } from '../lib/data';
import { getCreator, getTopicsForTip } from '../lib/data';

interface Props {
  tip: Tip;
}

const { tip } = Astro.props;
const creator = getCreator(tip.creator_id);
const topics = getTopicsForTip(tip);

const difficultyColors = {
  'quick-win': 'bg-green-100 text-green-800',
  'moderate': 'bg-yellow-100 text-yellow-800',
  'advanced': 'bg-red-100 text-red-800',
};

const difficultyLabels = {
  'quick-win': 'Quick Win',
  'moderate': 'Moderate',
  'advanced': 'Advanced',
};

const statusColors = {
  'active': '',
  'contested': 'bg-orange-100 text-orange-800',
  'outdated': 'bg-gray-100 text-gray-600',
};

const sourceTypeLabels = {
  'twitter': 'Twitter',
  'linkedin': 'LinkedIn',
  'youtube': 'YouTube',
  'blog': 'Blog',
};
---

<article class="space-y-6">
  <!-- Title -->
  <h1 class="text-2xl font-bold text-gray-900 leading-tight">
    {tip.title}
  </h1>

  <!-- Direct Answer -->
  <p class="text-lg text-gray-700 leading-relaxed">
    {tip.content}
  </p>

  <!-- When to use -->
  <section class="bg-green-50 border border-green-200 rounded-lg p-4">
    <h2 class="text-sm font-semibold text-green-800 uppercase tracking-wide mb-2">
      When to use this
    </h2>
    <p class="text-gray-700">
      {tip.when_useful}
    </p>
  </section>

  <!-- When to skip -->
  <section class="bg-amber-50 border border-amber-200 rounded-lg p-4">
    <h2 class="text-sm font-semibold text-amber-800 uppercase tracking-wide mb-2">
      When to skip this
    </h2>
    <p class="text-gray-700">
      {tip.when_ignore}
    </p>
  </section>

  <!-- Metadata row -->
  <div class="flex flex-wrap items-center gap-3 text-sm">
    <span class={`px-3 py-1 rounded-full font-medium ${difficultyColors[tip.difficulty]}`}>
      {difficultyLabels[tip.difficulty]}
    </span>

    {tip.status !== 'active' && (
      <span class={`px-3 py-1 rounded-full font-medium ${statusColors[tip.status]}`}>
        {tip.status.charAt(0).toUpperCase() + tip.status.slice(1)}
      </span>
    )}

    {tip.tools_required && (
      <span class="px-3 py-1 rounded-full bg-blue-100 text-blue-800 font-medium">
        {tip.tools_required}
      </span>
    )}
  </div>

  <!-- Topics -->
  {topics.length > 0 && (
    <div class="flex flex-wrap gap-2">
      {topics.map(topic => (
        <a
          href={`/topics/${topic.slug}`}
          class="text-sm text-gray-600 hover:text-blue-600 transition-colors"
        >
          #{topic.name}
        </a>
      ))}
    </div>
  )}

  <!-- Source and dates -->
  <div class="border-t border-gray-200 pt-6 space-y-3 text-sm text-gray-600">
    <!-- Attribution -->
    {creator && (
      <div class="flex items-center gap-2">
        <span class="text-gray-400">By</span>
        <a
          href={`/creators/${creator.slug}`}
          class="font-medium text-gray-900 hover:text-blue-600 transition-colors"
        >
          {creator.name}
        </a>
      </div>
    )}

    <!-- Source -->
    <div class="flex items-center gap-2">
      <span class="text-gray-400">Source:</span>
      <a
        href={tip.source_url}
        target="_blank"
        rel="noopener noreferrer"
        class="text-blue-600 hover:text-blue-800 transition-colors underline underline-offset-2"
      >
        {sourceTypeLabels[tip.source_type]} →
      </a>
    </div>

    <!-- Official docs reference -->
    {tip.docs_url && (
      <div class="flex items-start gap-2">
        <span class="text-gray-400">Docs:</span>
        <a
          href={tip.docs_url}
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-600 hover:text-blue-800 transition-colors underline underline-offset-2"
        >
          {tip.docs_section || 'Official documentation'} →
        </a>
      </div>
    )}

    <!-- Dates -->
    <div class="flex flex-wrap gap-4 text-xs text-gray-500">
      <span>Extracted: {tip.extracted_at}</span>
      {tip.verified_at && (
        <span class="text-green-600">Verified: {tip.verified_at}</span>
      )}
    </div>
  </div>
</article>
